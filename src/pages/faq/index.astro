---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { marked } from 'marked';

// Import FAQ markdown files using Astro.glob
const faqFiles = await Astro.glob('../../faq/*.md');

const faqs = faqFiles.map(faq => ({
  id: faq.file.split('/').pop()?.replace('.md', '') || '',
  question: faq.frontmatter.question,
  order: faq.frontmatter.order || 999,
  content: marked.parse(faq.rawContent()) as string
})).sort((a, b) => a.order - b.order);
---

<BaseLayout title="FAQ - EZ" description="Frequently asked questions about the EZ programming language.">
  <Header />

  <div class="flex-1 w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-3xl font-bold mb-2">Frequently Asked Questions</h1>
    <p class="opacity-60 mb-10">
      Common questions about the EZ programming language.
    </p>

    <div class="grid grid-cols-1 gap-8">
      {faqs.map((faq, index) => (
        <article
          id={faq.id}
          class="faq-entry rounded-lg overflow-hidden scroll-mt-24"
          style="border: 1px solid var(--ez-gray-border);"
        >
          <header
            class="px-6 py-4 cursor-pointer flex items-center justify-between"
            style="background-color: var(--ez-gray-bg);"
            data-faq-toggle={faq.id}
          >
            <h2 class="text-xl font-semibold">{faq.question}</h2>
            <svg
              class="faq-chevron w-5 h-5 transition-transform duration-200"
              data-faq-chevron={faq.id}
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </header>
          <div
            class="faq-content px-6 py-5 hidden"
            data-faq-content={faq.id}
          >
            <div
              class="faq-answer"
              set:html={faq.content}
            />
          </div>
        </article>
      ))}
    </div>
  </div>

  <Footer />
</BaseLayout>

<style is:global>
  .faq-entry {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }

  .faq-chevron.open {
    transform: rotate(180deg);
  }

  .faq-answer {
    line-height: 1.7;
    font-style: italic;
  }

  .faq-answer h2,
  .faq-answer code,
  .faq-answer pre {
    font-style: normal;
  }

  .faq-answer h2 {
    background: var(--ez-gray-bg);
    padding: 0.5rem 0.75rem;
    border-radius: 4px;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .faq-answer h3 {
    font-size: 1rem;
    font-weight: 600;
    opacity: 0.8;
    margin-top: 1.75rem;
    margin-bottom: 0.75rem;
  }

  .faq-answer > p {
    margin-bottom: 1.25rem;
  }

  .faq-answer ol {
    list-style: decimal;
    padding-left: 1.5rem;
    margin-bottom: 1rem;
  }

  .faq-answer li {
    margin-bottom: 0.5rem;
  }

  .faq-answer code {
    background-color: var(--ez-gray-bg);
    border: 1px solid var(--ez-gray-border);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  .faq-answer pre {
    background-color: var(--ez-gray-bg);
    border: 1px solid var(--ez-gray-border);
    border-radius: 0.5rem;
    padding: 1rem;
    overflow-x: auto;
    margin: 1rem 0;
  }

  .faq-answer pre code {
    background: none;
    border: none;
    padding: 0;
  }

  .faq-answer table {
    display: table;
    border-collapse: collapse;
    width: 100%;
    margin: 1.5rem 0;
  }

  .faq-answer thead {
    display: table-header-group;
  }

  .faq-answer tbody {
    display: table-row-group;
  }

  .faq-answer tr {
    display: table-row;
  }

  .faq-answer th,
  .faq-answer td {
    display: table-cell;
    border: 1px solid var(--ez-gray-border);
    padding: 0.75rem 1rem;
    text-align: left;
    vertical-align: top;
  }

  .faq-answer th {
    background-color: var(--ez-gray-bg);
    font-weight: 600;
  }
</style>

<script>
  function initFAQ() {
    const toggles = document.querySelectorAll('[data-faq-toggle]');

    toggles.forEach(toggle => {
      toggle.addEventListener('click', () => {
        const id = (toggle as HTMLElement).dataset.faqToggle;
        const content = document.querySelector(`[data-faq-content="${id}"]`);
        const chevron = document.querySelector(`[data-faq-chevron="${id}"]`);

        if (content && chevron) {
          content.classList.toggle('hidden');
          chevron.classList.toggle('open');
        }
      });
    });

  }

  initFAQ();
  document.addEventListener('astro:after-swap', initFAQ);
</script>
